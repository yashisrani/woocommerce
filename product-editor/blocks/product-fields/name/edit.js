"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.NameBlockEdit=void 0;const compose_1=require("@wordpress/compose"),data_1=require("@wordpress/data"),element_1=require("@wordpress/element"),i18n_1=require("@wordpress/i18n"),icons_1=require("@wordpress/icons"),url_1=require("@wordpress/url"),block_templates_1=require("@woocommerce/block-templates"),classnames_1=__importDefault(require("classnames")),components_1=require("@wordpress/components"),core_data_1=require("@wordpress/core-data"),edit_product_link_modal_1=require("../../../components/edit-product-link-modal"),label_1=require("../../../components/label/label"),validation_context_1=require("../../../contexts/validation-context"),use_product_edits_1=require("../../../hooks/use-product-edits"),use_product_entity_prop_1=__importDefault(require("../../../hooks/use-product-entity-prop")),utils_1=require("../../../utils");function NameBlockEdit({attributes,clientId}){const blockProps=(0,block_templates_1.useWooBlockProps)(attributes),{editEntityRecord,saveEntityRecord}=(0,data_1.useDispatch)("core"),{hasEdit}=(0,use_product_edits_1.useProductEdits)(),[showProductLinkEditModal,setShowProductLinkEditModal]=(0,element_1.useState)(!1),productId=(0,core_data_1.useEntityId)("postType","product"),product=(0,data_1.useSelect)((select=>select("core").getEditedEntityRecord("postType","product",productId))),[sku,setSku]=(0,core_data_1.useEntityProp)("postType","product","sku"),[name,setName]=(0,core_data_1.useEntityProp)("postType","product","name"),{prefix:permalinkPrefix,suffix:permalinkSuffix}=(0,utils_1.getPermalinkParts)(product),{ref:nameRef,error:nameValidationError,validate:validateName}=(0,validation_context_1.useValidation)("name",(async function nameValidator(){return name&&name!==utils_1.AUTO_DRAFT_NAME?name.length>120?{message:(0,i18n_1.__)("Please enter a product name shorter than 120 characters.","woocommerce")}:void 0:{message:(0,i18n_1.__)("Product name is required.","woocommerce")}}),[name]),help=null!=nameValidationError?nameValidationError:productId&&["publish","draft"].includes(product.status)&&permalinkPrefix&&(0,element_1.createElement)("span",{className:"woocommerce-product-form__secondary-text product-details-section__product-link"},(0,i18n_1.__)("Product link","woocommerce"),":Â ",(0,element_1.createElement)("a",{href:product.permalink,target:"_blank",rel:"noreferrer"},permalinkPrefix,product.slug||(0,url_1.cleanForSlug)(name),permalinkSuffix),(0,element_1.createElement)(components_1.Button,{variant:"link",onClick:()=>setShowProductLinkEditModal(!0)},(0,i18n_1.__)("Edit","woocommerce"))),nameControlId=(0,compose_1.useInstanceId)(components_1.BaseControl,"product_name"),{selectBlock}=(0,data_1.useDispatch)("core/block-editor");(0,element_1.useEffect)((()=>{attributes.autoFocus&&selectBlock(clientId)}),[]);const[featured,setFeatured]=(0,use_product_entity_prop_1.default)("featured");function handleSuffixClick(){setFeatured(!featured)}return(0,element_1.createElement)(element_1.Fragment,null,(0,element_1.createElement)("div",{...blockProps},(0,element_1.createElement)(components_1.BaseControl,{id:nameControlId,label:(0,element_1.createElement)(label_1.Label,{label:(0,i18n_1.__)("Name","woocommerce"),required:!0}),className:(0,classnames_1.default)({"has-error":nameValidationError}),help},(0,element_1.createElement)(components_1.__experimentalInputControl,{id:nameControlId,ref:nameRef,name:"name",autoFocus:attributes.autoFocus,placeholder:(0,i18n_1.__)("e.g. 12 oz Coffee Mug","woocommerce"),onChange:setName,value:name&&name!==utils_1.AUTO_DRAFT_NAME?name:"",autoComplete:"off","data-1p-ignore":!0,onBlur:()=>{hasEdit("name")&&(sku||nameValidationError||setSku((0,url_1.cleanForSlug)(name)),validateName())},suffix:function renderFeaturedSuffix(){const markedText=(0,i18n_1.__)("Mark as featured","woocommerce"),unmarkedText=(0,i18n_1.__)("Unmark as featured","woocommerce"),tooltipText=featured?unmarkedText:markedText;return(0,element_1.createElement)(components_1.Tooltip,{text:tooltipText,position:"top center"},featured?(0,element_1.createElement)(components_1.Button,{icon:icons_1.starFilled,"aria-label":unmarkedText,onClick:handleSuffixClick}):(0,element_1.createElement)(components_1.Button,{icon:icons_1.starEmpty,"aria-label":markedText,onClick:handleSuffixClick}))}()})),showProductLinkEditModal&&(0,element_1.createElement)(edit_product_link_modal_1.EditProductLinkModal,{permalinkPrefix:permalinkPrefix||"",permalinkSuffix:permalinkSuffix||"",product,onCancel:()=>setShowProductLinkEditModal(!1),onSaved:()=>setShowProductLinkEditModal(!1),saveHandler:async updatedSlug=>{const{slug,permalink}=await saveEntityRecord("postType","product",{id:product.id,slug:updatedSlug});if(slug&&permalink)return editEntityRecord("postType","product",product.id,{slug,permalink}),{slug,permalink}}})))}exports.NameBlockEdit=NameBlockEdit;