"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DescriptionBlockEdit=exports.getContentFromFreeform=void 0;const element_1=require("@wordpress/element"),blocks_1=require("@wordpress/blocks"),data_1=require("@wordpress/data"),classnames_1=__importDefault(require("classnames")),block_templates_1=require("@woocommerce/block-templates"),core_data_1=require("@wordpress/core-data"),i18n_1=require("@wordpress/i18n"),block_editor_1=require("@wordpress/block-editor"),modal_editor_welcome_guide_1=__importDefault(require("../../../components/modal-editor-welcome-guide")),product_editor_ui_1=require("../../../store/product-editor-ui"),full_editor_toolbar_button_1=__importDefault(require("./components/full-editor-toolbar-button"));function getContentFromFreeform(blocks){return!(1!==blocks.length||"core/freeform"!==blocks[0].name)&&blocks[0].attributes.content}function DescriptionBlockEdit({attributes}){const[description,setDescription]=(0,core_data_1.useEntityProp)("postType","product","description"),[descriptionBlocks,setDescriptionBlocks]=(0,element_1.useState)([]),{isModalEditorOpen,modalEditorBlocks,hasChanged}=(0,data_1.useSelect)((select=>({isModalEditorOpen:select(product_editor_ui_1.store).isModalEditorOpen(),modalEditorBlocks:select(product_editor_ui_1.store).getModalEditorBlocks(),hasChanged:select(product_editor_ui_1.store).getModalEditorContentHasChanged()})),[]);(0,element_1.useEffect)((()=>{if(!description)return void setDescriptionBlocks([]);if(-1===description.indexOf("\x3c!-- wp:"))return;const parsedBlocks=(0,blocks_1.parse)(description);getContentFromFreeform(parsedBlocks)||setDescriptionBlocks(parsedBlocks)}),[description]),(0,element_1.useEffect)((()=>{if(!hasChanged)return;const html=(0,blocks_1.serialize)(modalEditorBlocks);setDescription(html)}),[modalEditorBlocks,setDescription,hasChanged]);const blockProps=(0,block_templates_1.useWooBlockProps)(attributes,{className:(0,classnames_1.default)({"has-blocks":!!description.length}),tabIndex:0}),innerBlockProps=(0,block_editor_1.useInnerBlocksProps)({},{templateLock:"contentOnly",allowedBlocks:["woocommerce/product-summary-field"]});return(0,element_1.createElement)("div",{...blockProps},(null==descriptionBlocks?void 0:descriptionBlocks.length)?(0,element_1.createElement)(element_1.Fragment,null,(0,element_1.createElement)(block_editor_1.BlockControls,null,(0,element_1.createElement)(full_editor_toolbar_button_1.default,{text:(0,i18n_1.__)("Edit in full editor","woocommerce")})),(0,element_1.createElement)(block_editor_1.BlockPreview,{blocks:descriptionBlocks,viewportWidth:800,additionalStyles:[{css:"body { padding: 32px; height: 10000px }"}]})):(0,element_1.createElement)("div",{...innerBlockProps}),isModalEditorOpen&&(0,element_1.createElement)(modal_editor_welcome_guide_1.default,null))}exports.getContentFromFreeform=getContentFromFreeform,exports.DescriptionBlockEdit=DescriptionBlockEdit;