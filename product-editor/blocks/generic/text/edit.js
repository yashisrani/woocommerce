"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Edit=void 0;const block_templates_1=require("@woocommerce/block-templates"),compose_1=require("@wordpress/compose"),components_1=require("@woocommerce/components"),element_1=require("@wordpress/element"),i18n_1=require("@wordpress/i18n"),icons_1=require("@wordpress/icons"),text_control_1=require("../../../components/text-control"),validation_context_1=require("../../../contexts/validation-context"),use_product_edits_1=require("../../../hooks/use-product-edits"),use_product_entity_prop_1=__importDefault(require("../../../hooks/use-product-entity-prop"));function Edit({attributes,context:{postType}}){var _a;const blockProps=(0,block_templates_1.useWooBlockProps)(attributes),{property,label,placeholder,required,pattern,minLength,maxLength,min,max,help,tooltip,disabled,type,suffix}=attributes,[value,setValue]=(0,use_product_entity_prop_1.default)(property,{postType,fallbackValue:""}),{hasEdit}=(0,use_product_edits_1.useProductEdits)(),inputRef=(0,element_1.useRef)(null),{error,validate,ref:inputValidatorRef}=(0,validation_context_1.useValidation)(property,(async function validator(){var _a,_b,_c,_d,_e,_f;if(!inputRef.current)return;const input=inputRef.current;let customErrorMessage="";return input.validity.typeMismatch&&(customErrorMessage=null!==(_a=null==type?void 0:type.message)&&void 0!==_a?_a:(0,i18n_1.__)("Invalid value for the field.","woocommerce")),input.validity.valueMissing&&(customErrorMessage="string"==typeof required?required:(0,i18n_1.__)("This field is required.","woocommerce")),input.validity.patternMismatch&&(customErrorMessage=null!==(_b=null==pattern?void 0:pattern.message)&&void 0!==_b?_b:(0,i18n_1.__)("Invalid value for the field.","woocommerce")),input.validity.tooShort&&(customErrorMessage=(0,i18n_1.sprintf)(null!==(_c=null==minLength?void 0:minLength.message)&&void 0!==_c?_c:(0,i18n_1.__)("The minimum length of the field is %d","woocommerce"),null==minLength?void 0:minLength.value)),input.validity.tooLong&&(customErrorMessage=(0,i18n_1.sprintf)(null!==(_d=null==maxLength?void 0:maxLength.message)&&void 0!==_d?_d:(0,i18n_1.__)("The maximum length of the field is %d","woocommerce"),null==maxLength?void 0:maxLength.value)),input.validity.rangeUnderflow&&(customErrorMessage=(0,i18n_1.sprintf)(null!==(_e=null==min?void 0:min.message)&&void 0!==_e?_e:(0,i18n_1.__)("The minimum value of the field is %d","woocommerce"),null==min?void 0:min.value)),input.validity.rangeOverflow&&(customErrorMessage=(0,i18n_1.sprintf)(null!==(_f=null==max?void 0:max.message)&&void 0!==_f?_f:(0,i18n_1.__)("The maximum value of the field is %d","woocommerce"),null==max?void 0:max.value)),input.setCustomValidity(customErrorMessage),input.validity.valid?void 0:{message:customErrorMessage}}),[type,required,pattern,minLength,maxLength,min,max,value]);return(0,element_1.createElement)("div",{...blockProps},(0,element_1.createElement)(text_control_1.TextControl,{ref:(0,compose_1.useMergeRefs)([inputRef,inputValidatorRef]),type:null!==(_a=null==type?void 0:type.value)&&void 0!==_a?_a:"text",value,disabled,label,onChange:setValue,onBlur:()=>{hasEdit(property)&&validate()},error,help,placeholder,tooltip,suffix:function getSuffix(){if(!suffix||!value||!inputRef.current)return;const isValidUrl="url"===inputRef.current.type&&!inputRef.current.validity.typeMismatch;return!0===suffix&&isValidUrl?(0,element_1.createElement)(components_1.Link,{type:"external",href:value,target:"_blank",rel:"noreferrer",className:"wp-block-woocommerce-product-text-field__suffix-link"},(0,element_1.createElement)(icons_1.Icon,{icon:icons_1.external,size:20})):"string"==typeof suffix?suffix:void 0}(),required:Boolean(required),pattern:null==pattern?void 0:pattern.value,minLength:null==minLength?void 0:minLength.value,maxLength:null==maxLength?void 0:maxLength.value,min:null==min?void 0:min.value,max:null==max?void 0:max.value}))}exports.Edit=Edit;